.exec_base:
  stage: unstagged
  image: gitlab-registry.cern.ch/quasar-team/images/alma-10-build:latest
  variables:
    OPEN62541_COMPAT_VERSION: "new-pipeline"
  before_script:
    - python --version
    - git submodule update --init --recursive
    - git clone --depth=1 https://github.com/quasar-team/NodeSetTools.git
    - |
      # Install UaSwissArmyKnife dependency used by CI jobs
      curl -fL "https://gitlab.cern.ch/quasar-team/UaSwissArmyKnife/-/package_files/47559/download" -o /tmp/UaSwissArmyKnife.rpm
      dnf install -y /tmp/UaSwissArmyKnife.rpm
      export PATH="/opt/UaSwissArmyKnife/bin:${PATH}"

'Open62541: Default Quasar Design':
  extends: .exec_base
  script:
    - python .CI/run_test_case.py --opcua_backend o6 --open62541_compat_branch "$OPEN62541_COMPAT_VERSION" --compare_with_nodeset .CI/test_cases/test_default_quasar_design/reference_ns2.xml

'Open62541: Cache Variables':
  extends: .exec_base
  script:
    - mkdir -p Device/include Device/src
    - cp .CI/test_cases/test_cache_variables/DTestClass.test.h Device/include/DTestClass.h
    - cp .CI/test_cases/test_cache_variables/DTestClass.test.cpp Device/src/DTestClass.cpp
    - python .CI/run_test_case.py --opcua_backend o6 --open62541_compat_branch "$OPEN62541_COMPAT_VERSION" --design .CI/test_cases/test_cache_variables/Design.xml --config .CI/test_cases/test_cache_variables/config.xml --compare_with_nodeset .CI/test_cases/test_cache_variables/reference_ns2.xml

'Open62541: Recurrent HasObjects':
  extends: .exec_base
  script:
    - python .CI/run_test_case.py --opcua_backend o6 --open62541_compat_branch "$OPEN62541_COMPAT_VERSION" --design .CI/test_cases/test_recurrent_hasobjects/Design.xml --generate_all_devices --config .CI/test_cases/test_recurrent_hasobjects/config.xml

'Open62541: Single Variable Node':
  extends: .exec_base
  script:
    - python .CI/run_test_case.py --opcua_backend o6 --open62541_compat_branch "$OPEN62541_COMPAT_VERSION" --design .CI/test_cases/test_single_variable_node/Design.xml --generate_all_devices --config .CI/test_cases/test_single_variable_node/config.xml

'Open62541: Methods':
  extends: .exec_base
  script:
    - python .CI/run_test_case.py --opcua_backend o6 --open62541_compat_branch "$OPEN62541_COMPAT_VERSION" --design .CI/test_cases/test_methods/Design.xml --generate_all_devices --config .CI/test_cases/test_methods/config.xml --compare_with_nodeset .CI/test_cases/test_methods/reference_ns2.xml

'Open62541: Instantiation From Design':
  extends: .exec_base
  script:
    - python .CI/run_test_case.py --opcua_backend o6 --open62541_compat_branch "$OPEN62541_COMPAT_VERSION" --design .CI/test_cases/test_instantiation_from_design/Design.xml --generate_all_devices --config .CI/test_cases/test_instantiation_from_design/config.xml --compare_with_nodeset .CI/test_cases/test_instantiation_from_design/reference_ns2.xml

'Open62541: Config Entries':
  extends: .exec_base
  script:
    - python .CI/run_test_case.py --opcua_backend o6 --open62541_compat_branch "$OPEN62541_COMPAT_VERSION" --design .CI/test_cases/test_config_entries/Design.xml --generate_all_devices --config .CI/test_cases/test_config_entries/config.xml --compare_with_nodeset .CI/test_cases/test_config_entries/reference_ns2.xml

'Open62541: Config Restrictions':
  extends: .exec_base
  script:
    - python .CI/run_test_case.py --opcua_backend o6 --open62541_compat_branch "$OPEN62541_COMPAT_VERSION" --design .CI/test_cases/test_config_restrictions/Design.xml

'Open62541: Calculated Variables':
  extends: .exec_base
  script:
    - python .CI/run_test_case.py --opcua_backend o6 --open62541_compat_branch "$OPEN62541_COMPAT_VERSION" --design .CI/test_cases/test_calculated_variables/Design.xml --config .CI/test_cases/test_calculated_variables/config.xml --compare_with_nodeset .CI/test_cases/test_calculated_variables/reference_ns2.xml

'Open62541: Defaulted Instance Name':
  extends: .exec_base
  script:
    - python .CI/run_test_case.py --opcua_backend o6 --open62541_compat_branch "$OPEN62541_COMPAT_VERSION" --design .CI/test_cases/test_defaulted_instance_name/Design.xml --config .CI/test_cases/test_defaulted_instance_name/config.xml --compare_with_nodeset .CI/test_cases/test_defaulted_instance_name/reference_ns2.xml

'UASDK: Default Quasar Design':
  extends: .exec_base
  script:
    - python .CI/run_test_case.py --opcua_backend uasdk --compare_with_nodeset .CI/test_cases/test_default_quasar_design/reference_ns2.xml

'UASDK: Methods':
  extends: .exec_base
  script:
    - python .CI/run_test_case.py --opcua_backend uasdk --design .CI/test_cases/test_methods/Design.xml --generate_all_devices --config .CI/test_cases/test_methods/config.xml --compare_with_nodeset .CI/test_cases/test_methods/reference_ns2.xml

'UASDK: Async Methods':
  extends: .exec_base
  script:
    - python .CI/run_test_case.py --opcua_backend uasdk --design .CI/test_cases/test_async_methods/Design.xml --generate_all_devices --config .CI/test_cases/test_async_methods/config.xml --compare_with_nodeset .CI/test_cases/test_methods/reference_ns2.xml

'UASDK: Cache Variables':
  extends: .exec_base
  script:
    - mkdir -p Device/include Device/src
    - cp .CI/test_cases/test_cache_variables/DTestClass.test.h Device/include/DTestClass.h
    - cp .CI/test_cases/test_cache_variables/DTestClass.test.cpp Device/src/DTestClass.cpp
    - python .CI/run_test_case.py --opcua_backend uasdk --design .CI/test_cases/test_cache_variables/Design.xml --config .CI/test_cases/test_cache_variables/config.xml --compare_with_nodeset .CI/test_cases/test_cache_variables/reference_ns2.xml

'UASDK: Source Variables':
  extends: .exec_base
  script:
    - python .CI/run_test_case.py --opcua_backend uasdk --design .CI/test_cases/test_source_variables/Design.xml --generate_all_devices --config .CI/test_cases/test_source_variables/config.xml --compare_with_nodeset .CI/test_cases/test_source_variables/reference_ns2.xml

'UASDK: Config Entries':
  extends: .exec_base
  script:
    - python .CI/run_test_case.py --opcua_backend uasdk --design .CI/test_cases/test_config_entries/Design.xml --generate_all_devices --config .CI/test_cases/test_config_entries/config.xml --compare_with_nodeset .CI/test_cases/test_config_entries/reference_ns2.xml

'UASDK: Calculated Variables':
  extends: .exec_base
  script:
    - python .CI/run_test_case.py --opcua_backend uasdk --design .CI/test_cases/test_calculated_variables/Design.xml --config .CI/test_cases/test_calculated_variables/config.xml --compare_with_nodeset .CI/test_cases/test_calculated_variables/reference_ns2.xml
